<<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guess the Wikipedia Article</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        #titleDisplay { font-size: 24px; letter-spacing: 5px; margin-bottom: 20px; font-family: monospace; font-weight: bold; }
        #sentences { margin: 20px 0; max-width: 600px; line-height: 1.5; background: #f9f9f9; padding: 15px; border-radius: 8px; }
        .keyboard { display: flex; flex-wrap: wrap; max-width: 450px; justify-content: center; margin-top: 20px; }
        .key { width: 35px; height: 35px; margin: 5px; text-align: center; line-height: 35px; border: 1px solid #333; 
               cursor: pointer; background-color: #f0f0f0; border-radius: 4px; font-weight: bold; }
        .key:hover { background-color: #ddd; }
        .disabled { background-color: #ccc !important; color: #888; pointer-events: none; border-color: #aaa; }
        #gameOverOptions { margin-top: 20px; display: none; text-align: center; }
        button { padding: 10px 20px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        input { padding: 10px; width: 250px; }
    </style>
</head>
<body>

    <h1>Guess the Wikipedia Article</h1>
    <p id="titleDisplay"></p>  
    <div id="sentences"></div>
    
    <div id="gameControls">
        <input type="text" id="guessInput" placeholder="Guess the full title">
        <button onclick="submitFullGuess()">Submit Title</button>
    </div>
    
    <div class="keyboard" id="virtualKeyboard"></div>

    <div id="gameOverOptions">
        <h2 id="resultStatus"></h2>
        <button onclick="startGame()">Play Again</button>
        <br><br>
        <a id="wikiLink" target="_blank" style="color: #007bff; text-decoration: none; font-weight: bold;">Read More on Wikipedia</a>
    </div>

    <script>
        let currentSentenceIndex = 0;
        let sentences = [];
        let correctTitle = "";
        let revealedTitle = "";
        let articleURL = "";
        const BACKEND_URL = "https://profwebbackend.onrender.com";
        const guessedLetters = new Set();

        async function startGame() {
            // Reset UI
            document.getElementById("gameOverOptions").style.display = "none";
            document.getElementById("gameControls").style.display = "block";
            document.getElementById("sentences").innerHTML = "Loading clues...";
            document.getElementById("titleDisplay").textContent = "";
            document.getElementById("guessInput").value = "";
            guessedLetters.clear();
            currentSentenceIndex = 0;

            try {
                const response = await fetch(`${BACKEND_URL}/get_article`);
                const data = await response.json();
                
                console.log("Data received from server:", data);

                if (!data || !data.title) throw new Error("Invalid data");

                sentences = data.sentences;
                correctTitle = data.title.toLowerCase();
                articleURL = `https://en.wikipedia.org/wiki/${encodeURIComponent(data.title)}`;

                // Reveal spaces and non-alphabetical characters (hyphens, etc.)
                revealedTitle = correctTitle.replace(/[a-z]/g, "_");
                
                updateDisplay();
                document.getElementById("sentences").innerHTML = `<p><strong>Clue 1:</strong> ${sentences[0]}</p>`;
                setupKeyboard();

            } catch (error) {
                console.error("Fetch error:", error);
                document.getElementById("sentences").innerHTML = "Failed to load article. Please refresh.";
            }
        }

        function setupKeyboard() {
            const keyboard = document.getElementById("virtualKeyboard");
            keyboard.innerHTML = "";
            for (let i = 97; i <= 122; i++) { 
                let letter = String.fromCharCode(i);
                let keyButton = document.createElement("div");
                keyButton.classList.add("key");
                keyButton.textContent = letter;
                keyButton.onclick = () => guessLetter(letter);
                keyboard.appendChild(keyButton);
            }
        }

        function guessLetter(letter) {
            if (guessedLetters.has(letter)) return;
            guessedLetters.add(letter);
            
            // Disable key
            const keys = document.querySelectorAll(".key");
            keys.forEach(key => { if (key.textContent === letter) key.classList.add("disabled"); });

            if (correctTitle.includes(letter)) {
                let newRevealed = "";
                for (let i = 0; i < correctTitle.length; i++) {
                    newRevealed += (correctTitle[i] === letter || revealedTitle[i] !== "_") ? correctTitle[i] : "_";
                }
                revealedTitle = newRevealed;
                updateDisplay();
                if (revealedTitle === correctTitle) endGame(true);
            } else {
                nextClue();
            }
        }

        function nextClue() {
            currentSentenceIndex++;
            if (currentSentenceIndex < sentences.length) {
                document.getElementById("sentences").innerHTML += `<p><strong>Clue ${currentSentenceIndex + 1}:</strong> ${sentences[currentSentenceIndex]}</p>`;
            } else {
                endGame(false);
            }
        }

        function submitFullGuess() {
            const userGuess = document.getElementById("guessInput").value.toLowerCase().trim();
            if (userGuess === correctTitle) {
                endGame(true);
            } else {
                alert("Wrong title! Next clue revealed.");
                nextClue();
            }
        }

        function updateDisplay() {
            document.getElementById("titleDisplay").textContent = revealedTitle.split("").join(" ");
        }

        function endGame(won) {
            document.getElementById("gameControls").style.display = "none";
            document.getElementById("virtualKeyboard").innerHTML = "";
            document.getElementById("gameOverOptions").style.display = "block";
            document.getElementById("resultStatus").textContent = won ? "üéâ You Got It!" : "‚ùå Game Over!";
            document.getElementById("titleDisplay").textContent = correctTitle.toUpperCase();
            document.getElementById("wikiLink").href = articleURL;
            
            if (!won) {
                alert(`The correct article was: ${correctTitle.toUpperCase()}`);
            }
        }

        window.onload = startGame;
    </script>
</body>
</html>